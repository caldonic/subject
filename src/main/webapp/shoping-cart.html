<!DOCTYPE html>
<html lang="zxx">

<head>
  <meta charset="UTF-8" />
  <meta name="description" content="Ogani Template" />
  <meta name="keywords" content="Ogani, unica, creative, html" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Ogani | Template</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet" />
  <!--自然改-->
  <!-- Css Styles -->
  <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="css/elegant-icons.css" type="text/css" />
  <link rel="stylesheet" href="css/nice-select.css" type="text/css" />
  <link rel="stylesheet" href="css/jquery-ui.min.css" type="text/css" />
  <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
  <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
  <link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>
  <header class="header">
    <jsp:include page="/header.jsp"></jsp:include>
  </header>
  <!-- Header Section End -->

  <!-- Hero Section Begin -->
  <section class="hero hero-normal">
    <div class="container">
      <div class="row">
        <div class="col-lg-3">
          <div class="hero__categories">
            <div class="hero__categories__all">
              <i class="fa fa-bars"></i>
              <span>All departments</span>
            </div>
            <ul>
              <li><a href="#">Fresh Meat</a></li>
              <li><a href="#">Vegetables</a></li>
              <li><a href="#">Fruit & Nut Gifts</a></li>
              <li><a href="#">Fresh Berries</a></li>
              <li><a href="#">Ocean Foods</a></li>
              <li><a href="#">Butter & Eggs</a></li>
              <li><a href="#">Fastfood</a></li>
              <li><a href="#">Fresh Onion</a></li>
              <li><a href="#">Papayaya & Crisps</a></li>
              <li><a href="#">Oatmeal</a></li>
              <li><a href="#">Fresh Bananas</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-9">
          <div class="hero__search">
            <div class="hero__search__form">
              <form action="#">
                <div class="hero__search__categories">
                  All Categories
                  <span class="arrow_carrot-down"></span>
                </div>
                <input type="text" placeholder="What do yo u need?" />
                <button type="submit" class="site-btn">SEARCH</button>
              </form>
            </div>
            <div class="hero__search__phone">
              <div class="hero__search__phone__icon">
                <i class="fa fa-phone"></i>
              </div>
              <div class="hero__search__phone__text">
                <h5>+65 11.188.888</h5>
                <span>support 24/7 time</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Hero Section End -->

  <!-- Breadcrumb Section Begin -->
  <section class="breadcrumb-section set-bg" data-setbg="img/breadcrumb.jpg">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 text-center">
          <div class="breadcrumb__text">
            <h2>購物車</h2>
            <!--鎮鴻改--->
            <div class="breadcrumb__option">
              <a href="./index.html">首頁</a>
              <!--鎮鴻改--->
              <span>購物車</span>
              <!--鎮鴻改--->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Breadcrumb Section End -->
  <button id="oneprice"></button>
  <!--一鍵購物車 -->
  <!-- Shoping Cart Section Begin -->
  <section class="shoping-cart spad">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="shoping__cart__table">
            <table>
              <thead>
                <tr>
                  <th class="shoping__product">商品</th>
                  <th>單價</th>
                  <th>數量</th>
                  <th>總價(元)</th>
                  <!--鎮鴻改，以上四行--->
                  <th></th>
                </tr>
              </thead>

              <tbody id="cart_body">
                <!-- ====商品開始==== -->
                <!-- <tr id="tr_cart">
                    <td class="shoping__cart__item">
                      <img src="img/cart/cart-2.jpg" alt="" /> 
                      <h5><span id="product_name" class="card-title">香蕉你的芭樂</span></h5>
                    </td>
                    <td class="shoping__cart__price">
                      <span id="price" class="card-text">80</span> -->
                <!-- 鎮鴻改-span -->
                <!-- </td>
                    <td class="shoping__cart__quantity">
                      <div class="quantity">
                        <div class="pro-qty add_cart"  > -->
                <!-- data-price="80" -->
                <!-- <input type="text" value="1" class="qy_val amount" /> -->
                <!-- 鎮鴻改-input+class -->
                <!-- </div>
                      </div>
                    </td>
                    <td class="shoping__cart__total">
                      <span id="price_total"></span> -->
                <!-- 鎮鴻改-span -->
                <!-- </td>
                    <td class="shoping__cart__item__close">
                      <span class="icon_close"></span>
                    </td>
                  </tr>
                  <tr id="tr_cart">
                    <td class="shoping__cart__item"> -->
                <!-- <img src="img/cart/cart-3.jpg" alt="" /> -->
                <!-- <span id="product_name">乾檸檬雞排</span></h5>
                    </td>
                    <td class="shoping__cart__price">
                      <span id="price">60</span> -->
                <!-- 鎮鴻改-span -->
                <!-- </td>
                    <td class="shoping__cart__quantity">
                      <div class="quantity">
                        <div class="pro-qty add_cart"  > -->
                <!-- data-price="60" -->
                <!-- <input type="text" value="1" class="qy_val amount"  /> -->
                <!-- 鎮鴻改-input+class -->
                <!-- </div>
                      </div>
                    </td>
                    <td class="shoping__cart__total">
                      <span id="price_total">69</span> -->
                <!-- 鎮鴻改-span -->
                <!-- </td>
                    <td class="shoping__cart__item__close">
                      <span class="icon_close"></span>
                    </td>
                  </tr> -->
                <!-- ====商品結束==== -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <!-- <div class="shoping__cart__btns">
              <a href="#" class="primary-btn cart-btn">CONTINUE SHOPPING</a>
              <a href="#" class="primary-btn cart-btn cart-btn-right"
                ><span class="icon_loading"></span> Upadate Cart</a
              >
            </div> -->
          <!-- 鎮鴻改-以上五行 -->
          <!-- </div> -->
          <!-- <div class="col-lg-3">
            <div class="shoping__continue">
              <div class="shoping__discount">
                <h5>優惠券</h5>
                <form action="#">
                  <input
                    id="coupon_val"
                    name="couponname"
                    class="SELECT_COUPON_NAME"
                    type="text"
                    placeholder="請輸入優惠券名稱"
                    pattern="[a-zA-Z]{0,}"
                  />
              
                  <input type="button" class="site-btn" id="coupon_use" value="使用" >
                  </input>
      
                </form>
              </div>
            </div>
          </div> -->
          <!-- 鎮鴻改-以上為Discount Codes  -->
          <!-- <div class="col-lg-3">
            <div class="shoping__continue">
              <div class="shoping__discount">
                <h5>購物金</h5>
                <form action="#">
                  <input
                    id="golden_val"
                    type="text"
                    placeholder="請輸入使用之購物金金額"
                    pattern="\d{0,}"
                  /> -->
          <!-- 鎮鴻改-新增正規化驗證pattern數字四碼 -->
          <!-- <input
                    type="button"
                    class="site-btn"
                    id="golden_use"
                    value="使用"
                  />  </input> -->
          <!-- 鎮鴻改-綁使用存在local -->
          <!-- </form>
              </div>
            </div>
          </div> -->
          <!-- 鎮鴻改-以上為購物金使用金額-->
          <div class="col-lg-">
            <div class="shoping__checkout">
              <ul>
                <!-- <li>Subtotal <span>$454.98</span></li> -->
                <li>總計(元) <span id="total_cart">0</span></li>
              </ul>
              <a href="./checkout.html" class="primary-btn" id="upcoming_pay">進行付款</a>
              <!--鎮鴻改-實際上線時須變更連結及按鈕id-->
              <hr />
              <a class="btn btn-secondary text-white" id="clear">清空購物車</a>
              <!-- 鎮鴻改-以上測試按鈕-->
            </div>
            <!-- 鎮鴻改-以上為購物車總價區  -->
          </div>
        </div>
      </div>
  </section>
  <!-- Shoping Cart Section End -->

  <!-- Footer Section Begin -->
  <footer class="footer spad">
    <jsp:include page="/footer.jsp"></jsp:include>
  </footer>
  <!-- Footer Section End -->

  <!-- Js Plugins -->
  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.nice-select.min.js"></script>
  <script src="js/jquery-ui.min.js"></script>
  <script src="js/jquery.slicknav.js"></script>
  <script src="js/mixitup.min.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/main.js"></script>

  <script>
    //// 鎮鴻改sessionStorage
    $(function () {
      const getCart = () => {
        if (sessionStorage.getItem("memcart_data")) {
          var memcart = JSON.parse(sessionStorage.getItem("memcart_data"));
          console.log(memcart);
          var price = 0;
          var total = 0;
          var i = 0;
          //// 設定唯一值index刪除memcart_data
          for (i = 0; i < memcart.length; i++) {
            var html = "";
            html += `
            <tr id="tr_cart" class="${memcart[i].itemserialnumber}">
                <td class="shoping__cart__item">
                  <h5><span id="product_name" class="card-title">${memcart[i].itemname
              }</span></h5></td>
                <td class="shoping__cart__price">
                  <span id="price" class="card-text">${memcart[i].itemprice
              }元</span></td>
                <td class="shoping__cart__quantity">
                  <div class="quantity">
                    <div class="pro-qty add_cart">
                      <input type="text" value=" ${memcart[i].itemquantity
              }" class="qy_val amount" data="${i}"/>
                 </div>
                      </div></td>
                      <td class="shoping__cart__total">
                      <span id="price_total"></span>${memcart[i].itemprice * memcart[i].itemquantity
              } </td>
                          <td class="shoping__cart__item__close">
                      <span class="icon_close"></span>
                    </td>
                          </tr>  `;
            ////計算單項商品總價
            price = memcart[i].itemprice * memcart[i].itemquantity;
            ////計算購物車總價
            total += price;
            $("#cart_body").append(html);
            $("#total_cart").html(total);
          }
          ///數量更新
          $(".qy_val").on("change",
            function (e) {
              let c = confirm("確認是否更新此項商品?");
              if (c) {
                $(this)
                  .closest("#tr_cart")
                  .find(".qy_val")
                  .val();

                var index = this.getAttribute("data");
                memcart[index]["itemquantity"] = Number(this.value);
                console.log("======", memcart)

                sessionStorage.setItem("memcart_data", JSON.stringify(memcart)); //更新sessionStorage
                location.reload(); //網頁重整
              }
            }
          );
          ////移除商品
          // $("td.shoping__cart__item__close").on(
          //   "click",
          //   "span.icon_close",
          //   function (e) {
          //     let c = confirm("確認是否移除此項商品?");
          //     if (c) {
          //       $(this)
          //         .closest("#tr_cart")
          //         .fadeOut(100, () => {
          //           $(this).remove(); //移除網頁上被指定項目
          //           console.log(memcart[i]);
          //           // console.log(i);
          //           memcart.splice(memcart.indexOf("memcart[i]")); //刪除陣列單項商品
          //           sessionStorage.setItem(
          //             "memcart_data",
          //             JSON.stringify(memcart)
          //           ); //sessionStorage
          //           location.reload(); //網頁重整(只能從最後一個刪)
          //         });
          //     }
          //   }
          // );
        }

      }
      ////購物車項目
      getCart();
      ////清空購物車
      $("#clear").click(() => {
        let c = confirm("請確認是否清空購物車?");
        if (c) {
          sessionStorage.removeItem("memcart_data");
          location.reload();
        }
      });
       ////移除商品
      const btn = document.querySelectorAll('.shoping__cart__item__close')
      //e微陣列每個元素,i為元素index
      btn.forEach((e, i) => {
        e.onclick = () => {
          let data = JSON.parse(sessionStorage.getItem('memcart_data'))
          sessionStorage.setItem('memcart_data',JSON.stringify( data.filter((e,index)=>i !==index )))
          getCart()
          history.go()
        }
      })
    });
    /*-------------------
            Quantity change
          // --------------------- */
    // $(function () {
    //   var proQty = $(".pro-qty");
    //   proQty.prepend('<span class="dec qtybtn">-</span>');
    //   proQty.append('<span class="inc qtybtn">+</span>');
    //   proQty.on("click", ".qtybtn", function () {
    //     var $button = $(this);
    //     var oldValue = $button.parent().find("input").val();
    //     if ($button.hasClass("inc")) {
    //       var newVal = parseFloat(oldValue) + 1;
    //     } else {
    //       // Don't allow decrementing below zero
    //       if (oldValue > 0) {
    //         var newVal = parseFloat(oldValue) - 1;
    //       } else {
    //         newVal = 0;
    //       }
    //     }
    //     $button.parent().find("input").val(newVal);
    //   });
    // });

    //// 一鍵入魂處理購物車
    $("#oneprice").on("click", () => {
      //只要抓一次的資料
      let memInfoitem = {
        cartserialnumber: 10,
        memberserialnumber: 1636001,
        cartcreatetime: new Date(),
      };
      //Tue Jul 12 2016 11:35:48 GMT+0800 (CST)
      //CART_CREATE_TIME:new Date().getTime()   時間戳
      //https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part3/datetime.html

      //商品資料
      let item1 = {
        itemserialnumber: "87878701",
        itemname: "尾玉牛肉麵",
        itemprice: 187,
        itemquantity: 2,
      };

      let item2 = {
        itemserialnumber: "87878703",
        itemname: "曼當勞",
        itemprice: 37,
        itemquantity: 1,
      };

      let item3 = {
        itemserialnumber: "87878707",
        itemname: "吉野家",
        itemprice: 132,
        itemquantity: 1,
      };

      //儲存一次性的陣列(可不用存進陣列)
      // let memInfo = [];
      //儲存商品的陣列
      let memcart = [];

      // memInfo.push(memInfoitem);
      memcart.push(item1);
      memcart.push(item2);
      memcart.push(item3);

      console.log(memInfoitem); //方便測試
      console.log(memcart);

      sessionStorage.setItem("memcart_data", JSON.stringify(memcart));
      sessionStorage.setItem("memInfo", JSON.stringify(memInfoitem));
      location.reload(); //網頁重整
    })
  </script>
  <script>


  </script>
</body>

</html>